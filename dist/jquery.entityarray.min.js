/*! jquery.entityarray 2013-11-06 */
!function(a){"use strict";function b(b,e){this.element=b,this.options=a.extend({},d,e),this._defaults=d,this._name=c,this.init()}var c="entityArray",d={propertyName:"value"};b.prototype={init:function(){var b=this;this.entities={},this.element.addClass("entity-array"),this.createEmptyInput(),this.options.entities&&a.each(this.options.entities,function(){b.add(this)})},add:function(b){var c=this;return this.normalizeEntityData(b),!b.id||""===b||this.entities[b.id]?null:(b.element=a("<span/>").html(b.name).css("background",b.color||this.options.color).appendTo(this.element).after(" "),a("<input/>").attr("type","hidden").attr("name",this.options.inputNames).val(b.id).appendTo(b.element),a("<span/>").addClass("icon-close").appendTo(b.element).data("entity-id",b.id).click(function(){c.removeEntity(a(this).data("entity-id"))}),this.entities[b.id]=b,this.removeEmptyInput(),b)},removeEntity:function(a){var b=this.entities[a];b.element.remove(),delete this.entities[a],0===Object.keys(this.entities).length&&this.createEmptyInput(),"function"==typeof this.options.afterRemove&&this.options.afterRemove(b)},normalizeEntityData:function(a){a.id=a.id.toString(),a.name=a.name.toString()},createEmptyInput:function(){this.emptyInput=a("<input/>").attr("type","hidden").attr("name",this.options.inputNames).appendTo(this.element)},removeEmptyInput:function(){this.emptyInput&&(this.emptyInput.remove(),this.emptyInput=null)}},a.fn[c]=function(d,e){return this.each(function(){var f=a.data(this,"plugin_"+c);f?"string"==typeof d&&f[d].call(f,e):a.data(this,"plugin_"+c,new b(a(this),d))})}}(jQuery,window,document);